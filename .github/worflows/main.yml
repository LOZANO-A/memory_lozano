name: Workflow_tp_memory    # Nom du workflow

on:
  push:
    branches:
      - develop    # Le workflow se déclenche sur un push vers la branche 'develop'

jobs:
  test-memory:
    runs-on: self-hosted

    steps:
      - name: Verif code
        uses: actions/checkout@v2

      - name: Verif fichier jpg
          run: |
              IMG_REPLACEMENT = "img_st.jpg"    #cherche l'image de remplacement
              for file in $(find . -name '*.jpg'); do    #trouve et verifie les ficher jpg
                echo "Vérification de $file"
                if ! file "$file" | grep -q 'JPEG'; then
                  echo "$file est corrompu. Remplacement..."
                  cp "$REPLACEMENT_IMAGE" "$file"    #remplace si corrompu
                fi
              done
